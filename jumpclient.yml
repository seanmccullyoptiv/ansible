---
- hosts: all
  become: true
  tasks:
    - name: Ribbit
      user:
        name: toad
        comment: Because it jumps, get it
        uid: 1001
        shell: /bin/bash
        password: $1$SomeSalt$vn3N2kuXMnfyyhcNSDkv21
    - name: Grab the latest jc binary
      get_url:
        dest: /home/toad/
        url: ftp://anonymous@dc.packet.farm:21/etc/bomgar-pec.bin
    - name: Once you got it introduce it to toad
      file:
        path: /home/toad/bomgar-pec.bin
        mode: +x
        owner: toad
        group: toad
    - name: check if installed
      stat:
        path: /home/toad/jumpclient/
      register: presentjc
    - name: Run it like its hot
      command: /home/toad/bomgar-pec.bin --install-dir /home/toad/jumpclient
      become: yes
      become_user: toad
      when: presentjc.stat.exists == False
    - name: Check if pec is running
      shell: pgrep bomgar-pec
      ignore_errors: yes
      changed_when: false
      register: pec-running-status
    - name: Starts init if it aint runnin
      fail:
        msg: |
          Service bomgar-pec is not running.
          Return code from `pgrep`:
          {{ pec_running_status.rc }}
      when: pec_running_status.rc != 0
        
